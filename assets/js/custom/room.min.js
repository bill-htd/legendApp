var Request=undefined;Request=GetRequest();var channel=Request["channel"];var token=Request["token"];var serverPortAry=[];var serverId=[];var address=[];var loginData=[];var paramObj={httpUrl:info.get_roomList_address,type:"post"};var self=this;this.loading=$.openCustomLoading("数据请求中");httpRequest(paramObj,function(e){self.loading.hide();var t=JSON.parse(e);if(t.code==0){for(var a=0;a<t.data.length;a++){if(t.data[a].is_test==2){self.add_div(t.data[a]);document.getElementById("scroller").style.height=35*(a+1)}}var r=localStorage.getItem("selectedIndex");if(r){document.getElementById("swiper").style.height="75%";document.getElementById("lastSelectdIndex").style.display="";if(document.getElementById("list"+r).className&&document.getElementById("list"+r).className!="room maintain"){document.getElementById("list"+r).className="room hot"}for(var a=0;a<t.data.length;a++){if(t.data[a].id==r){self.add_div2(t.data[a])}}}else{document.getElementById("swiper").style.height="95%";document.getElementById("lastSelectdIndex").style.display="none"}var n=new Swiper(".swiper-container",{direction:"vertical",slidesPerView:"auto",freeMode:true,scrollbar:{el:".swiper-scrollbar"},mousewheel:true})}else{alert(t.msg)}});function add_div2(e){var t=document.createElement("div");t.className="room hot";t.id="list"+e.id;serverPortAry[e.id]=e.server_port;serverId[e.id]=e.server_id;address[e.id]=e.database_host;document.getElementById("lastSelectdIndex").appendChild(t);var a=document.createElement("span");a.innerHTML=e.server_name;t.appendChild(a);var r=document.createElement("i");if(e.server_state==4){r.className="icon font new"}else if(e.server_state==1){r.className="icon font maintain";t.className="room maintain"}else{r.className="icon font boom"}t.appendChild(r);var n=document.createElement("div");n.className="_room";t.appendChild(n);n.onclick=function(e){if(e.target.parentNode.className=="room maintain")return;var t=e.target.parentNode.id.split("");var a=t.splice(4);var r=a.join("");if(!r)return;self.button_onclick(r)}}function add_div(e){var t={serverId:e.server_id,serverName:e.server_name};loginData.push(t);var a=document.createElement("div");a.className="room boom";a.id="list"+e.id;serverPortAry[e.id]=e.server_port;serverId[e.id]=e.server_id;address[e.id]=e.database_host;document.getElementById("scroller").appendChild(a);var r=document.createElement("span");r.innerHTML=e.server_name;a.appendChild(r);var n=document.createElement("i");if(e.server_state==4){n.className="icon font new"}else if(e.server_state==1){n.className="icon font maintain";a.className="room maintain"}else{n.className="icon font boom"}a.appendChild(n);var s=document.createElement("div");s.className="_room";a.appendChild(s);s.onclick=function(e){if(e.target.parentNode.className=="room maintain")return;var t=e.target.parentNode.id.split("");var a=t.splice(4);var r=a.join("");if(!r)return;self.button_onclick(r)}}function GetRequest(){var e=decodeURI(window.location.search);var t=new Object;if(e.indexOf("?")!=-1){var a=e.substr(1);strs=a.split("&");for(var r=0;r<strs.length;r++){t[strs[r].split("=")[0]]=unescape(strs[r].split("=")[1])}}return t}function button_onclick(e){for(var t=0;t<document.getElementById("scroller").children.length;t++){if(t==0)continue;document.getElementById("scroller").children[t].className="room boom"}document.getElementById("list"+e).className="room hot";localStorage.setItem("selectedIndex",parseInt(e));if(token){var a=serverPortAry[e];var r=address[e];var n=serverId[e];var s={httpUrl:info.get_channel_login_address,type:"post",data:{token:token,channel:channel,serverid:n}};var o=this;this.loading=$.openCustomLoading("登录中，长时间未响应请刷新网页");httpRequest(s,function(e){var t=JSON.parse(e);if(t.code==0){o.loading.hide();var a=JSON.stringify(t.data);var r=toCode(a);window.top.location.href=info.jumpAddress+r}else{alert(t.msg)}})}else{window.history.go(-1)}}var toCode=function(e){var t="9873216540AZCDEFGHIJKLMNOPQRSTUVWXYB";var a=t.length;var r=t.split("");var n="",s,o,i,d;for(var l=0;l<e.length;l++){s=e.charCodeAt(l);o=s%a;s=(s-o)/a;i=s%a;s=(s-i)/a;d=s%a;n+=r[d]+r[i]+r[o]}return n};function httpRequest(e,t,a){var r=null;if(window.XMLHttpRequest){r=new XMLHttpRequest}else if(window.ActiveXObject){r=new ActiveXObject("Microsoft.XMLHTTP")}if(r==null){alert("你的浏览器不支持XMLHttp");return}var n=(e.type||"GET").toUpperCase();var s=e.dataType||"json";var o=e.httpUrl||"";var i=e.async||true;var d=e.data||[];var l="";for(var c in d){l+=c+"="+d[c]+"&"}l=l==""?"":l.substring(0,l.length-1);r.onreadystatechange=function(){if(r.readyState==4&&r.status==200){t(r.responseText)}else{a}};if(n=="GET"){r.open("GET",o,i);r.send(null)}else if(n=="POST"){o+=l;r.open("POST",o,i);r.setRequestHeader("Content-type","application/x-www-form-urlencoded");r.send(l)}}