var Request=undefined;Request=GetRequest();var channel=Request["channel"];var token=Request["token"];var serverPortAry=[];var address=[];var paramObj={httpUrl:"http://winyso.com/gm/index.php?m=ServerInfo&a=server_list",type:"post"};var self=this;this.loading=$.openCustomLoading("数据请求中");httpRequest(paramObj,function(e){self.loading.hide();var t=JSON.parse(e);if(t.code==0){for(var r=0;r<t.data.length;r++){if(t.data[r].is_test==2){self.add_div(t.data[r])}}var a=localStorage.getItem("selectedIndex");if(a){document.getElementById("list"+a).className="room hot"}}else{alert(t.msg)}});function add_div(e){var t=document.createElement("div");t.className="room boom";var r=localStorage.getItem("selectedIndex");if(!r){localStorage.setItem("selectedIndex",parseInt(e.server_id))}t.id="list"+e.server_id;serverPortAry[e.server_id]=e.server_port;address[e.server_id]=e.database_host;document.getElementById("scroller").appendChild(t);var a=document.createElement("span");a.innerHTML=e.server_name;t.appendChild(a);var s=document.createElement("i");if(e.server_state==4){s.className="icon font new"}else{s.className="icon font boom"}t.appendChild(s);var n=document.createElement("div");n.className="_room";t.appendChild(n);n.onclick=function(e){var t=e.target.parentNode.id.split("");var r=t.splice(4);var a=r.join("");if(!a)return;self.button_onclick(a)}}function GetRequest(){var e=decodeURI(window.location.search);var t=new Object;if(e.indexOf("?")!=-1){var r=e.substr(1);strs=r.split("&");for(var a=0;a<strs.length;a++){t[strs[a].split("=")[0]]=unescape(strs[a].split("=")[1])}}return t}function button_onclick(o){for(var e=0;e<document.getElementById("scroller").children.length;e++){document.getElementById("scroller").children[e].className="room boom"}document.getElementById("list"+o).className="room hot";localStorage.setItem("selectedIndex",parseInt(o));if(token){var d=serverPortAry[o];var i=address[o];var t={httpUrl:"http://winyso.com/gm/index.php?m=Regi&a=channel_login&",type:"post",data:{token:token,channel:channel,serverid:o}};var l=this;this.loading=$.openCustomLoading("登录中，长时间未响应请刷新网页");httpRequest(t,function(e){l.loading.hide();var t=JSON.parse(e);if(t.code==0){var r=window.location.href.split("?");var a=r[0];var s=a+"?srvid="+o+"&user="+t.data.username+"&spverify="+t.data.password+"&serverid="+o+"&srvaddr="+i+"&srvport="+d;var n={};n.id="eE";n.urlParam=s;window.parent.postMessage(n,"*")}else{alert(t.msg)}})}}function httpRequest(e,t,r){var a=null;if(window.XMLHttpRequest){a=new XMLHttpRequest}else if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLHTTP")}if(a==null){alert("你的浏览器不支持XMLHttp");return}var s=(e.type||"GET").toUpperCase();var n=e.dataType||"json";var o=e.httpUrl||"";var d=e.async||true;var i=e.data||[];var l="";for(var c in i){l+=c+"="+i[c]+"&"}l=l==""?"":l.substring(0,l.length-1);a.onreadystatechange=function(){if(a.readyState==4&&a.status==200){t(a.responseText)}else{r}};if(s=="GET"){a.open("GET",o,d);a.send(null)}else if(s=="POST"){o+=l;a.open("POST",o,d);a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.send(l)}}